<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>明日方舟小游戏喵</title>
  <!-- Tailwind CSS 精简CDN（仅核心样式） -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4F46E5',
            accent: '#F59E0B'
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .glassmorphism {
        @apply bg-white/30 backdrop-blur-md border border-white/50;
      }
      .card-container {
        @apply relative w-full h-full rounded-lg overflow-hidden shadow-md transition-transform duration-300 hover:scale-[1.02];
      }
      .card-image {
        @apply w-full h-full object-cover transition-all duration-300;
      }
      .card-glass {
        @apply absolute inset-0 glassmorphism transition-opacity duration-200 opacity-0 pointer-events-none;
      }
      .card-glass-visible {
        @apply opacity-100 pointer-events-auto;
      }
      .card-disabled {
        @apply opacity-50 cursor-not-allowed;
      }
      .card-selected {
        @apply ring-4 ring-accent ring-offset-2;
      }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-5xl">
    <!-- 代码输入区 -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <div class="flex flex-col md:flex-row gap-4">
        <input type="text" id="code-input" placeholder="输入代码（例如：ARknights123）" class="flex-1 px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
        <button id="apply-code-btn" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-md transition-colors">应用代码</button>
      </div>
    </div>
    
    <!-- 游戏区域 -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <!-- 图片矩阵 -->
      <div id="image-grid" class="grid grid-cols-5 gap-4 mb-8 card-disabled"></div>
      
      <!-- 选择区域 -->
      <div class="flex flex-col items-center gap-4">
        <div id="selected-image-container" class="w-32 h-32 rounded-lg overflow-hidden border-4 border-primary shadow-lg hidden">
          <img id="selected-image" src="" alt="选择的图片" class="w-full h-full object-cover">
        </div>
        <button id="confirm-selection-btn" class="bg-accent hover:bg-accent/90 text-white px-6 py-2 rounded-md transition-colors hidden">确认选择</button>
      </div>
    </div>
    
    <!-- 重置按钮 -->
    <div class="text-center">
      <button id="reset-btn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-md transition-colors">重置游戏</button>
    </div>
  </div>
  
  <script>
    // 图片库
    const imageLibrary = [
      "https://media.prts.wiki/3/3d/%E5%A4%B4%E5%83%8F_%E5%87%9B%E5%BE%A1%E9%93%B6%E7%81%B0.png",
      "https://media.prts.wiki/a/ab/%E5%A4%B4%E5%83%8F_%E5%9C%A3%E8%81%86%E5%88%9D%E9%9B%AA.png",
      "https://media.prts.wiki/d/d0/%E5%A4%B4%E5%83%8F_%E6%BA%AF%E5%85%89%E6%98%9F%E6%BA%90.png",
      "https://media.prts.wiki/6/63/%E5%A4%B4%E5%83%8F_%E7%9C%9F%E8%A8%80.png",
      "https://media.prts.wiki/c/cb/%E5%A4%B4%E5%83%8F_%E4%B8%B0%E5%B7%9D%E7%A5%A5%E5%AD%90.png",
      "https://media.prts.wiki/e/e5/%E5%A4%B4%E5%83%8F_%E6%96%A9%E4%B8%9A%E6%98%9F%E7%86%8A.png",
      "https://media.prts.wiki/e/ec/%E5%A4%B4%E5%83%8F_%E9%81%A5.png",
      "https://media.prts.wiki/5/56/%E5%A4%B4%E5%83%8F_%E7%94%B5%E5%BC%A7.png",
      "https://media.prts.wiki/5/5c/%E5%A4%B4%E5%83%8F_%E5%8F%B8%E9%9C%86%E6%83%8A%E8%9B%B0.png",
      "https://media.prts.wiki/0/0d/%E5%A4%B4%E5%83%8F_%E9%85%92%E7%A5%9E.png",
      "https://media.prts.wiki/3/3a/%E5%A4%B4%E5%83%8F_%E6%96%B0%E7%BA%A6%E8%83%BD%E5%A4%A9%E4%BD%BF.png",
      "https://media.prts.wiki/c/c5/%E5%A4%B4%E5%83%8F_%E8%95%BE%E7%BC%AA%E5%AE%89.png",
      "https://media.prts.wiki/1/13/%E5%A4%B4%E5%83%8F_%E4%BF%A1%E4%BB%B0%E6%90%85%E6%8B%8C%E6%9C%BA.png",
      "https://media.prts.wiki/2/2a/%E5%A4%B4%E5%83%8F_Mon3tr.png",
      "https://media.prts.wiki/d/d9/%E5%A4%B4%E5%83%8F_%E6%AD%BB%E8%8A%92.png",
      "https://media.prts.wiki/4/4c/%E5%A4%B4%E5%83%8F_%E9%9A%90%E5%BE%B7%E6%9D%A5%E5%B8%8C.png",
      "https://media.prts.wiki/6/66/%E5%A4%B4%E5%83%8F_%E4%BD%99.png",
      "https://media.prts.wiki/c/c4/%E5%A4%B4%E5%83%8F_%E7%83%9B%E7%85%8C.png",
      "https://media.prts.wiki/3/3b/%E5%A4%B4%E5%83%8F_%E5%BC%95%E6%98%9F%E6%A3%98%E5%88%BA.png",
      "https://media.prts.wiki/0/04/%E5%A4%B4%E5%83%8F_%E8%8D%92%E8%8A%9C%E6%8B%89%E6%99%AE%E5%85%B0%E5%BE%B7.png",
      "https://media.prts.wiki/7/79/%E5%A4%B4%E5%83%8F_%E5%BF%8D%E5%86%AC.png",
      "https://media.prts.wiki/1/12/%E5%A4%B4%E5%83%8F_%E5%BC%91%E5%90%9B%E8%80%85.png",
      "https://media.prts.wiki/6/68/%E5%A4%B4%E5%83%8F_%E7%BB%B4%E5%A8%9C%C2%B7%E7%BB%B4%E5%A4%9A%E5%88%A9%E4%BA%9A.png",
      "https://media.prts.wiki/8/84/%E5%A4%B4%E5%83%8F_%E7%8E%9B%E9%9C%B2%E8%A5%BF%E5%B0%94.png",
      "https://media.prts.wiki/8/85/%E5%A4%B4%E5%83%8F_%E4%BD%A9%E4%BD%A9.png"
    ];
    
    // 全局状态
    let currentImageUrls = [];
    let selectedIndex = -1;
    let isCodeApplied = false;
    let isConfirmed = false;
    let visibleGlass = new Set();
    
    // DOM元素
    const dom = {
      grid: document.getElementById('image-grid'),
      codeInput: document.getElementById('code-input'),
      applyBtn: document.getElementById('apply-code-btn'),
      selectedContainer: document.getElementById('selected-image-container'),
      selectedImg: document.getElementById('selected-image'),
      confirmBtn: document.getElementById('confirm-selection-btn'),
      resetBtn: document.getElementById('reset-btn')
    };
    
    // 初始化
    function init() {
      currentImageUrls = [];
      selectedIndex = -1;
      isCodeApplied = false;
      isConfirmed = false;
      visibleGlass.clear();
      
      dom.grid.innerHTML = '';
      dom.grid.classList.add('card-disabled');
      dom.codeInput.value = '';
      dom.selectedContainer.classList.add('hidden');
      dom.selectedImg.src = '';
      dom.confirmBtn.classList.add('hidden');
      
      // 聚焦输入框
      setTimeout(() => dom.codeInput.focus(), 100);
    }
    
    // 随机打乱数组（带种子）
    function shuffle(arr, seed) {
      const newArr = [...arr];
      if (!seed) return newArr.sort(() => Math.random() - 0.5);
      
      let state = seed;
      const prng = () => (state = (1664525 * state + 1013904223) % Math.pow(2, 32)) / Math.pow(2, 32);
      
      for (let i = newArr.length - 1; i > 0; i--) {
        const j = Math.floor(prng() * (i + 1));
        [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
      }
      return newArr;
    }
    
    // 应用代码
    function applyCode(code) {
      const seed = code.split('').reduce((acc, c) => acc + c.charCodeAt(0), 0);
      let base = [...imageLibrary];
      while (base.length < 20) base.push(...imageLibrary);
      
      currentImageUrls = shuffle(base, seed).slice(0, 20);
      isCodeApplied = true;
      dom.grid.classList.remove('card-disabled');
      dom.grid.innerHTML = '';
      
      const fragment = document.createDocumentFragment();
      currentImageUrls.forEach((url, i) => {
        fragment.appendChild(createCard(url, i, false));
      });
      dom.grid.appendChild(fragment);
    }
    
    // 创建卡片
    function createCard(url, index, isToggleable) {
      const container = document.createElement('div');
      container.className = `aspect-square cursor-${isToggleable ? 'pointer' : 'default'}`;
      container.dataset.index = index;
      
      const card = document.createElement('div');
      card.className = 'card-container';
      
      const img = document.createElement('img');
      img.src = url;
      img.alt = `角色 ${index+1}`;
      img.className = 'card-image';
      
      const glass = document.createElement('div');
      glass.className = 'card-glass';
      
      card.append(img, glass);
      container.appendChild(card);
      
      container.onclick = () => {
        if (isToggleable) {
          if (visibleGlass.has(index)) {
            glass.classList.remove('card-glass-visible');
            visibleGlass.delete(index);
          } else {
            glass.classList.add('card-glass-visible');
            visibleGlass.add(index);
          }
        } else if (isCodeApplied && !isConfirmed) {
          document.querySelectorAll('[data-index]').forEach(el => {
            el.querySelector('.card-container').classList.remove('card-selected');
          });
          card.classList.add('card-selected');
          selectedIndex = index;
          dom.selectedImg.src = url;
          dom.selectedContainer.classList.remove('hidden');
          dom.confirmBtn.classList.remove('hidden');
        }
      };
      
      return container;
    }
    
    // 确认选择
    function confirmSelection() {
      if (selectedIndex === -1) return;
      
      isConfirmed = true;
      dom.confirmBtn.classList.add('hidden');
      dom.grid.innerHTML = '';
      
      const fragment = document.createDocumentFragment();
      currentImageUrls.forEach((url, i) => {
        fragment.appendChild(createCard(url, i, true));
      });
      dom.grid.appendChild(fragment);
    }
    
    // 事件绑定
    function bindEvents() {
      dom.applyBtn.addEventListener('click', () => {
        const code = dom.codeInput.value.trim();
        if (code) applyCode(code);
      });
      
      // 键盘输入优化
      dom.codeInput.addEventListener('keydown', e => {
        // 阻止默认行为解决输入问题
        if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Home', 'End'].includes(e.key)) {
          e.preventDefault();
        }
      });
      
      // 回车键提交
      dom.codeInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') {
          const code = dom.codeInput.value.trim();
          if (code) applyCode(code);
        }
      });
      
      dom.confirmBtn.addEventListener('click', confirmSelection);
      dom.resetBtn.addEventListener('click', init);
    }
    
    // 初始化应用
    document.addEventListener('DOMContentLoaded', () => {
      bindEvents();
      init();
    });
  </script>
</body>
</html>
